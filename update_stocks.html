<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Stocks - Dimi's Donuts</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="update_stocks.css">
    <link rel="stylesheet" href="admin_dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   
</head>
<body class="signup-body">
    <!-- Admin Dashboard -->
    <div class="admin-dashboard">
        <!-- Sidebar Navigation -->
        <nav class="admin-sidebar">
            <h1>Dashboard</h1>
            <ul class="admin-nav">
                <li><a href="admin_dashboard.html">Orders</a></li>
                <li><a href="update_stocks.html" class="active">Update Stocks</a></li>
                <li><a href="view_reports.html">View Reports</a></li>
            </ul>
            <div class="logout-container">
                <a href="#" class="logout-btn" id="logoutBtn">Logout</a>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="admin-main">
            <div class="admin-content">
                <!-- System Header -->
                <div class="system-header">
                    <h2>DIMI DONUTS INVENTORY SYSTEM</h2>
                </div>
                
                <!-- Stocks Content -->
                <div class="stocks-container">
                    <div class="stocks-header">
                        <h3>Inventory</h3>
                    </div>
                    
                    <div class="stocks-grid" id="stocksGrid">
                        <!-- Stock cards will be generated by JavaScript -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Low Stock Notification -->
    <div id="lowStockNotification" class="low-stock-notification">
        <div class="notification-icon">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="notification-content">
            <div class="notification-title">Low Stock Alert</div>
            <p class="notification-message" id="notificationMessage">Some products are running low on stock.</p>
        </div>
        <button class="notification-close" id="closeNotification">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Updated Ingredients Modal -->
<div id="ingredientsModal" class="ingredients-modal">
    <div class="ingredients-modal-content">
        <div class="ingredients-modal-header">
            <h2>Ingredients needed:</h2>
            <button class="ingredients-modal-close" id="ingredientsClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="ingredients-modal-body">
            <div class="ingredients-section">
                <div class="ingredients-table-container">
                    <table class="ingredients-table">
                        <thead>
                            <tr>
                                <th>Ingredient</th>
                                <th>Unit</th>
                                <th>Category</th>
                                <th>Quantity</th>
                                <th>Unit Price</th>
                                <th>Total Cost</th>
                            </tr>
                        </thead>
                        <tbody id="modalIngredientsTable">
                            <!-- Ingredients table will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="product-info-section">
                <div class="product-price">
                    <h3 id="modalDonutName">DONUT TOWER A</h3>
                    <div class="price" id="modalDonutPrice">₱1,000</div>
                </div>
                
                <div class="product-description">
                    <h4>DESCRIPTION</h4>
                    <p id="modalDonutDescription">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse ac tristique nunc, eget porttitor nisl. Sed tempus scelerisque augue at venenatis. Vestibulum accumsan scelerisque turpis. Cras et cursus elit.</p>
                </div>
                
                <div class="ingredients-cost">
                    <h4>INGREDIENTS TOTAL COST</h4>
                    <div class="cost-value" id="modalIngredientsCost">₱0</div>
                </div>
            </div>
        </div>
    </div>
</div>

    <!-- Updated Individual Product Dialog -->
<div id="productDialog" class="product-dialog">
    <div class="product-dialog-content">
        <div class="product-dialog-header">
            <button class="product-dialog-close" id="productDialogClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="product-dialog-body">
            <div class="dialog-ingredients-section">
                <h3 class="section-title">Ingredients needed:</h3>
                <div class="ingredients-table-container">
                    <table class="ingredients-table" id="dialogIngredientsTable">
                        <thead>
                            <tr>
                                <th>Ingredient</th>
                                <th>Unit</th>
                                <th>Category</th>
                                <th>Quantity</th>
                                <th>Unit Price</th>
                                <th>Total Cost</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Ingredients will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="dialog-product-section">
                <div class="product-price">
                    <h3 id="dialogDonutName">DONUT TOWER A</h3>
                    <div class="price" id="dialogDonutPrice">₱1,000</div>
                </div>
                
                <div class="product-description">
                    <h4>DESCRIPTION</h4>
                    <p id="dialogDonutDescription">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse ac tristique nunc, eget porttitor nisl. Sed tempus scelerisque augue at venenatis. Vestibulum accumsan scelerisque turpis. Cras et cursus elit.</p>
                </div>
                
                <div class="ingredients-cost">
                    <h4>INGREDIENTS TOTAL COST</h4>
                    <div class="cost-value" id="dialogIngredientsCost">₱0</div>
                </div>
                
                <div class="stock-update-section">
                    <div class="stock-update-info">
                        <span class="stock-update-label">Current Stock</span>
                        <span class="stock-update-value" id="dialogCurrentStock">8</span>
                    </div>
                    
                    <div class="stock-update-change">
                        <button class="change-btn" id="dialogDecreaseBtn"></button>
                        <span class="stock-update-change-display" id="dialogChangeDisplay">+1</span>
                        <button class="change-btn" id="dialogIncreaseBtn"></button>
                    </div>
                    
                    <button class="stock-update-btn" id="dialogUpdateBtn">UPDATE STOCK</button>
                </div>

                <div class="product-dialog-actions">
                    <button class="edit-product-btn" id="editProductBtn">EDIT PRODUCT</button>
                    <button class="delete-product-btn" id="deleteProductBtn">DELETE PRODUCT</button>
                </div>
            </div>
        </div>
    </div>
</div>

    <!-- Add New Product Modal -->
<div id="addProductModal" class="product-dialog">
    <div class="product-dialog-content">
        <div class="product-dialog-header">
            <h2>Add New Product</h2>
            <button class="product-dialog-close" id="addProductClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="product-dialog-body">
            <div class="dialog-ingredients-section">
                <h3 class="section-title">Ingredients Information</h3>
                <div class="ingredients-form">
                    <div class="form-group">
                        <label for="ingredientName">Ingredient Name</label>
                        <input type="text" id="ingredientName" placeholder="Enter ingredient name">
                    </div>
                    <div class="form-group">
                        <label for="ingredientQuantity">Quantity</label>
                        <input type="number" id="ingredientQuantity" placeholder="0" min="0" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="ingredientUnit">Unit of Measurement</label>
                        <select id="ingredientUnit">
                            <option value="kilos">kilos</option>
                            <option value="grams">grams</option>
                            <option value="liters">liters</option>
                            <option value="pieces">pieces</option>
                            <option value="cups">cups</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="ingredientCategory">Category</label>
                        <select id="ingredientCategory">
                            <option value="Dry Ingredients">Dry Ingredients</option>
                            <option value="Wet Ingredients">Wet Ingredients</option>
                            <option value="Toppings">Toppings</option>
                            <option value="Fillings">Fillings</option>
                            <option value="Flavoring">Flavoring</option>
                            <option value="Leavening">Leavening</option>
                            <option value="Cooking">Cooking</option>
                            <option value="Spices">Spices</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="ingredientPrice">Unit Price (₱)</label>
                        <input type="number" id="ingredientPrice" placeholder="0.00" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="ingredientUnitType">Price Unit</label>
                        <input type="text" id="ingredientUnitType" placeholder="per kilo, per liter, etc.">
                    </div>
                    <button class="add-ingredient-btn" id="addIngredientBtn">Add Ingredient</button>
                    
                    <div class="ingredients-table-container" style="margin-top: 20px;">
                        <table class="ingredients-table">
                            <thead>
                                <tr>
                                    <th>Ingredient</th>
                                    <th>Unit</th>
                                    <th>Category</th>
                                    <th>Quantity</th>
                                    <th>Unit Price</th>
                                    <th>Total Cost</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="newIngredientsTable">
                                <!-- New ingredients will be added here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="dialog-product-section">
                <div class="product-form">
                    <div class="form-group">
                        <label for="productName">Set Name</label>
                        <input type="text" id="productName" placeholder="Enter product name">
                    </div>
                    
                    <div class="form-group">
                        <label for="productPrice">Price (₱)</label>
                        <input type="number" id="productPrice" placeholder="0.00" min="0" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label for="productDescription">Description</label>
                        <textarea id="productDescription" placeholder="Enter product description" rows="4"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="maxStock">Maximum Stock</label>
                        <input type="number" id="maxStock" placeholder="50" min="1" value="50">
                    </div>
                    
                    <div class="ingredients-cost">
                        <h4>INGREDIENTS TOTAL COST</h4>
                        <div class="cost-value" id="newIngredientsCost">₱0</div>
                    </div>
                    
                    <button class="stock-update-btn" id="saveProductBtn">SAVE PRODUCT</button>
                </div>
            </div>
        </div>
    </div>
</div>

    <!-- Edit Product Modal -->
<div id="editProductModal" class="product-dialog">
    <div class="product-dialog-content">
        <div class="product-dialog-header">
            <h2>Edit Product</h2>
            <button class="product-dialog-close" id="editProductClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="product-dialog-body">
            <div class="dialog-ingredients-section">
                <h3 class="section-title">Ingredients Information</h3>
                <div class="ingredients-form">
                    <div class="form-group">
                        <label for="editIngredientName">Ingredient Name</label>
                        <input type="text" id="editIngredientName" placeholder="Enter ingredient name">
                    </div>
                    <div class="form-group">
                        <label for="editIngredientQuantity">Quantity</label>
                        <input type="number" id="editIngredientQuantity" placeholder="0" min="0" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="editIngredientUnit">Unit of Measurement</label>
                        <select id="editIngredientUnit">
                            <option value="kilos">kilos</option>
                            <option value="grams">grams</option>
                            <option value="liters">liters</option>
                            <option value="pieces">pieces</option>
                            <option value="cups">cups</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editIngredientCategory">Category</label>
                        <select id="editIngredientCategory">
                            <option value="Dry Ingredients">Dry Ingredients</option>
                            <option value="Wet Ingredients">Wet Ingredients</option>
                            <option value="Toppings">Toppings</option>
                            <option value="Fillings">Fillings</option>
                            <option value="Flavoring">Flavoring</option>
                            <option value="Leavening">Leavening</option>
                            <option value="Cooking">Cooking</option>
                            <option value="Spices">Spices</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editIngredientPrice">Unit Price (₱)</label>
                        <input type="number" id="editIngredientPrice" placeholder="0.00" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="editIngredientUnitType">Price Unit</label>
                        <input type="text" id="editIngredientUnitType" placeholder="per kilo, per liter, etc.">
                    </div>
                    <button class="add-ingredient-btn" id="editAddIngredientBtn">Add Ingredient</button>
                    
                    <div class="ingredients-table-container" style="margin-top: 20px;">
                        <table class="ingredients-table">
                            <thead>
                                <tr>
                                    <th>Ingredient</th>
                                    <th>Unit</th>
                                    <th>Category</th>
                                    <th>Quantity</th>
                                    <th>Unit Price</th>
                                    <th>Total Cost</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="editIngredientsTable">
                                <!-- Edit ingredients will be added here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="dialog-product-section">
                <div class="product-form">
                    <div class="form-group">
                        <label for="editProductName">Set Name</label>
                        <input type="text" id="editProductName" placeholder="Enter product name">
                    </div>
                    
                    <div class="form-group">
                        <label for="editProductPrice">Price (₱)</label>
                        <input type="number" id="editProductPrice" placeholder="0.00" min="0" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label for="editProductDescription">Description</label>
                        <textarea id="editProductDescription" placeholder="Enter product description" rows="4"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="editMaxStock">Maximum Stock</label>
                        <input type="number" id="editMaxStock" placeholder="50" min="1" value="50">
                    </div>
                    
                    <div class="ingredients-cost">
                        <h4>INGREDIENTS TOTAL COST</h4>
                        <div class="cost-value" id="editIngredientsCost">₱0</div>
                    </div>
                    
                    <button class="stock-update-btn" id="updateProductBtn">UPDATE PRODUCT</button>
                </div>
            </div>
        </div>
    </div>
</div>

    <!-- Update Confirmation Modal -->
    <div id="updateConfirmationModal" class="confirmation-modal">
        <div class="confirmation-content">
            <div class="confirmation-header">
                <h2>Update Stock</h2>
            </div>
            <div class="confirmation-body">
                <div class="confirmation-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M3 6a3 3 0 013-3h12a3 3 0 013 3v12a3 3 0 01-3 3H6a3 3 0 01-3-3V6zm14.25 3a.75.75 0 00-.75-.75h-9a.75.75 0 000 1.5h9a.75.75 0 00.75-.75zm0 3a.75.75 0 00-.75-.75h-9a.75.75 0 000 1.5h9a.75.75 0 00.75-.75zm0 3a.75.75 0 00-.75-.75h-9a.75.75 0 000 1.5h9a.75.75 0 00.75-.75z" />
                    </svg>
                </div>
                <h3>Are you sure?</h3>
                <p>You are about to update the stock for <strong id="confirmationProductName">this product</strong>. This will add <strong id="confirmationStockChange">+1</strong> to the current stock.</p>
                <div class="confirmation-actions">
                    <button class="confirmation-btn confirmation-cancel">Cancel</button>
                    <button class="confirmation-btn confirmation-confirm">Update Stock</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteConfirmationModal" class="confirmation-modal">
        <div class="confirmation-content">
            <div class="confirmation-header">
                <h2>Delete Product</h2>
            </div>
            <div class="confirmation-body">
                <div class="confirmation-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path fill-rule="evenodd" d="M16.5 4.478v.227a48.816 48.816 0 013.878.512.75.75 0 11-.256 1.478l-.209-.035-1.005 13.07a3 3 0 01-2.991 2.77H8.084a3 3 0 01-2.991-2.77L4.087 6.66l-.209.035a.75.75 0 01-.256-1.478A48.567 48.567 0 017.5 4.705v-.227c0-1.564 1.213-2.9 2.816-2.951a52.662 52.662 0 013.369 0c1.603.051 2.815 1.387 2.815 2.951zm-6.136-1.452a51.196 51.196 0 013.273 0C14.39 3.05 15 3.684 15 4.478v.113a49.488 49.488 0 00-6 0v-.113c0-.794.609-1.428 1.364-1.452zm-.355 5.945a.75.75 0 10-1.5.058l.347 9a.75.75 0 101.499-.058l-.346-9zm5.48.058a.75.75 0 10-1.498-.058l-.347 9a.75.75 0 001.5.058l.345-9z" clip-rule="evenodd" />
                    </svg>
                </div>
                <h3>Are you sure?</h3>
                <p>You are about to delete <strong id="deleteProductName">this product</strong>. This action cannot be undone.</p>
                <div class="confirmation-actions">
                    <button class="confirmation-btn delete-cancel">Cancel</button>
                    <button class="confirmation-btn delete-confirm">Delete Product</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="confirmation-modal">
        <div class="confirmation-content">
            <div class="confirmation-header">
                <h2>Stock Updated!</h2>
            </div>
            <div class="confirmation-body">
                <div class="confirmation-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z" clip-rule="evenodd" />
                    </svg>
                </div>
                <h3>Success!</h3>
                <p>Stock quantities have been updated successfully.</p>
                <div class="confirmation-actions">
                    <button class="confirmation-btn success-close">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Logout Confirmation Modal -->
    <div id="logoutModal" class="confirmation-modal">
        <div class="confirmation-content">
            <div class="confirmation-header">
                <h2>Logout</h2>
            </div>
            <div class="confirmation-body">
                <div class="confirmation-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path fill-rule="evenodd" d="M7.5 3.75A1.5 1.5 0 006 5.25v13.5a1.5 1.5 0 001.5 1.5h6a1.5 1.5 0 001.5-1.5V15a.75.75 0 011.5 0v3.75a3 3 0 01-3 3h-6a3 3 0 01-3-3V5.25a3 3 0 013-3h6a3 3 0 013 3V9A.75.75 0 0115 9V5.25a1.5 1.5 0 00-1.5-1.5h-6zm5.03 4.72a.75.75 0 010 1.06l-1.72 1.72h10.94a.75.75 0 010 1.5H10.81l1.72 1.72a.75.75 0 11-1.06 1.06l-3-3a.75.75 0 010-1.06l3-3a.75.75 0 011.06 0z" clip-rule="evenodd" />
                    </svg>
                </div>
                <h3>Ready to leave?</h3>
                <p>Are you sure you want to logout from the admin dashboard?</p>
                <div class="confirmation-actions">
                    <button class="confirmation-btn logout-cancel">Cancel</button>
                    <button class="confirmation-btn logout-confirm">Logout</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Product Confirmation Modal -->
<div id="addProductConfirmationModal" class="confirmation-modal">
    <div class="confirmation-content">
        <div class="confirmation-header">
            <h2>Add New Product</h2>
        </div>
        <div class="confirmation-body">
            <div class="confirmation-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3 6a3 3 0 013-3h12a3 3 0 013 3v12a3 3 0 01-3 3H6a3 3 0 01-3-3V6zm14.25 3a.75.75 0 00-.75-.75h-9a.75.75 0 000 1.5h9a.75.75 0 00.75-.75zm0 3a.75.75 0 00-.75-.75h-9a.75.75 0 000 1.5h9a.75.75 0 00.75-.75zm0 3a.75.75 0 00-.75-.75h-9a.75.75 0 000 1.5h9a.75.75 0 00.75-.75z" />
                </svg>
            </div>
            <h3>Confirm New Product</h3>
            <p>Are you sure you want to add <strong id="addConfirmationProductName">this product</strong>?</p>
            <p><strong>Price:</strong> <span id="addConfirmationProductPrice">₱0</span></p>
            <p><strong>Max Stock:</strong> <span id="addConfirmationProductStock">0</span></p>
            <div class="confirmation-actions">
                <button class="confirmation-btn add-confirm-cancel">Cancel</button>
                <button class="confirmation-btn add-confirm-confirm">Add Product</button>
            </div>
        </div>
    </div>
</div>

<!-- Update Product Confirmation Modal -->
<div id="updateProductConfirmationModal" class="confirmation-modal">
    <div class="confirmation-content">
        <div class="confirmation-header">
            <h2>Update Product</h2>
        </div>
        <div class="confirmation-body">
            <div class="confirmation-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M21.731 2.269a2.625 2.625 0 00-3.712 0l-1.157 1.157 3.712 3.712 1.157-1.157a2.625 2.625 0 000-3.712zM19.513 8.199l-3.712-3.712-12.15 12.15a5.25 5.25 0 00-1.32 2.214l-.8 2.685a.75.75 0 00.933.933l2.685-.8a5.25 5.25 0 002.214-1.32L19.513 8.2z" />
                </svg>
            </div>
            <h3>Confirm Product Update</h3>
            <p>Are you sure you want to update <strong id="updateProductConfirmationName">this product</strong>?</p>
            <p>This will overwrite all existing product information.</p>
            <div class="confirmation-actions">
                <button class="confirmation-btn update-confirm-cancel">Cancel</button>
                <button class="confirmation-btn update-confirm-confirm">Update Product</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Product Success Modal -->
<div id="addProductSuccessModal" class="confirmation-modal">
    <div class="confirmation-content">
        <div class="confirmation-header">
            <h2>Product Added!</h2>
        </div>
        <div class="confirmation-body">
            <div class="confirmation-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z" clip-rule="evenodd" />
                </svg>
            </div>
            <h3>Success!</h3>
            <p>New product has been added successfully to the inventory.</p>
            <div class="confirmation-actions">
                <button class="confirmation-btn add-success-close">Close</button>
            </div>
        </div>
    </div>
</div>

    <script>
    // Updated stock data with the real Dimi Donuts products
const stockData = [
    {
        id: 1,
        name: "Donut Tray A.1 - Chocolate",
        currentStock: 8,
        maxStock: 50,
        image: "Donut Tray A.1",
        lastUpdated: "2024-01-15",
        status: "critical",
        change: 1,
        price: "₱550",
        description: "48 pieces of our delectable chocolate mini donuts served on a tray. Mini donuts topped with thick and creamy chocolate icing, filled inside with chocolate cream.",
        ingredientsCost: "₱402",
        ingredients: [
            { name: "All-purpose flour", quantity: 4, uom: "cups", category: "Dry Ingredients", price: 45, unit: "total" },
            { name: "White sugar", quantity: 0.25, uom: "cups", category: "Dry Ingredients", price: 4, unit: "total" },
            { name: "Instant dry yeast", quantity: 2.25, uom: "tsp", category: "Leavening", price: 7, unit: "total" },
            { name: "Salt", quantity: 1, uom: "tsp", category: "Spices", price: 1, unit: "total" },
            { name: "Vanilla Extract", quantity: 1, uom: "tsp", category: "Flavoring", price: 10, unit: "total" },
            { name: "Warm milk", quantity: 1, uom: "cup", category: "Wet Ingredients", price: 30, unit: "total" },
            { name: "Unsalted butter", quantity: 0.25, uom: "cup", category: "Wet Ingredients", price: 45, unit: "total" },
            { name: "Eggs", quantity: 2, uom: "pieces", category: "Wet Ingredients", price: 25, unit: "total" },
            { name: "Chocolate Pastry Cream", quantity: 1.5, uom: "cups", category: "Fillings", price: 135, unit: "total" },
            { name: "Chocolate Icing", quantity: 1, uom: "cup", category: "Toppings", price: 100, unit: "total" }
        ]
    },
    {
        id: 2,
        name: "Donut Tray A.2 - Strawberry",
        currentStock: 15,
        maxStock: 50,
        image: "Donut Tray A.2",
        lastUpdated: "2024-01-15",
        status: "low",
        change: 1,
        price: "₱560",
        description: "48 pieces of our fruity strawberry mini donuts served on a tray. Mini donuts topped with thick and creamy strawberry icing, filled inside with strawberry cream.",
        ingredientsCost: "₱402",
        ingredients: [
            { name: "All-purpose flour", quantity: 4, uom: "cups", category: "Dry Ingredients", price: 45, unit: "total" },
            { name: "White sugar", quantity: 0.25, uom: "cups", category: "Dry Ingredients", price: 4, unit: "total" },
            { name: "Instant dry yeast", quantity: 2.25, uom: "tsp", category: "Leavening", price: 7, unit: "total" },
            { name: "Salt", quantity: 1, uom: "tsp", category: "Spices", price: 1, unit: "total" },
            { name: "Vanilla Extract", quantity: 1, uom: "tsp", category: "Flavoring", price: 10, unit: "total" },
            { name: "Warm milk", quantity: 1, uom: "cup", category: "Wet Ingredients", price: 30, unit: "total" },
            { name: "Unsalted butter", quantity: 0.25, uom: "cup", category: "Wet Ingredients", price: 45, unit: "total" },
            { name: "Eggs", quantity: 2, uom: "pieces", category: "Wet Ingredients", price: 25, unit: "total" },
            { name: "Strawberry Pastry Cream", quantity: 1.5, uom: "cups", category: "Fillings", price: 135, unit: "total" },
            { name: "Strawberry Icing", quantity: 1, uom: "cup", category: "Toppings", price: 100, unit: "total" }
        ]
    },
    {
        id: 3,
        name: "Donut Tray A.3 - Matcha",
        currentStock: 20,
        maxStock: 50,
        image: "Donut Tray A.3",
        lastUpdated: "2024-01-14",
        status: "normal",
        change: 1,
        price: "₱580",
        description: "48 pieces of our aromatic matcha mini donuts served on a tray. Mini donuts topped with thick and creamy matcha icing, filled inside with matcha cream.",
        ingredientsCost: "₱402",
        ingredients: [
            { name: "All-purpose flour", quantity: 4, uom: "cups", category: "Dry Ingredients", price: 45, unit: "total" },
            { name: "White sugar", quantity: 0.25, uom: "cups", category: "Dry Ingredients", price: 4, unit: "total" },
            { name: "Instant dry yeast", quantity: 2.25, uom: "tsp", category: "Leavening", price: 7, unit: "total" },
            { name: "Salt", quantity: 1, uom: "tsp", category: "Spices", price: 1, unit: "total" },
            { name: "Vanilla Extract", quantity: 1, uom: "tsp", category: "Flavoring", price: 10, unit: "total" },
            { name: "Warm milk", quantity: 1, uom: "cup", category: "Wet Ingredients", price: 30, unit: "total" },
            { name: "Unsalted butter", quantity: 0.25, uom: "cup", category: "Wet Ingredients", price: 45, unit: "total" },
            { name: "Eggs", quantity: 2, uom: "pieces", category: "Wet Ingredients", price: 25, unit: "total" },
            { name: "Matcha Pastry Cream", quantity: 1.5, uom: "cups", category: "Fillings", price: 135, unit: "total" },
            { name: "Matcha Icing", quantity: 1, uom: "cup", category: "Toppings", price: 100, unit: "total" }
        ]
    },
    {
        id: 4,
        name: "Donut Tray B.1 - Chocolate & Strawberry",
        currentStock: 10,
        maxStock: 30,
        image: "Donut Tray B.1",
        lastUpdated: "2024-01-15",
        status: "low",
        change: 1,
        price: "₱590",
        description: "24 pieces of our delectable chocolate mini donuts and 24 pieces of our fruity strawberry mini donuts served on a tray together.",
        ingredientsCost: "₱402",
        ingredients: [
            { name: "All-purpose flour", quantity: 4, uom: "cups", category: "Dry Ingredients", price: 45, unit: "total" },
            { name: "White sugar", quantity: 0.25, uom: "cups", category: "Dry Ingredients", price: 4, unit: "total" },
            { name: "Instant dry yeast", quantity: 2.25, uom: "tsp", category: "Leavening", price: 7, unit: "total" },
            { name: "Salt", quantity: 1, uom: "tsp", category: "Spices", price: 1, unit: "total" },
            { name: "Vanilla Extract", quantity: 1, uom: "tsp", category: "Flavoring", price: 10, unit: "total" },
            { name: "Warm milk", quantity: 1, uom: "cup", category: "Wet Ingredients", price: 30, unit: "total" },
            { name: "Unsalted butter", quantity: 0.25, uom: "cup", category: "Wet Ingredients", price: 45, unit: "total" },
            { name: "Eggs", quantity: 2, uom: "pieces", category: "Wet Ingredients", price: 25, unit: "total" },
            { name: "Chocolate & Strawberry Cream", quantity: 1.5, uom: "cups", category: "Fillings", price: 135, unit: "total" },
            { name: "Chocolate & Strawberry Icing", quantity: 1, uom: "cup", category: "Toppings", price: 100, unit: "total" }
        ]
    },
    {
        id: 5,
        name: "Donut Tray B.2 - Chocolate & Matcha",
        currentStock: 12,
        maxStock: 30,
        image: "Donut Tray B.2",
        lastUpdated: "2024-01-14",
        status: "low",
        change: 1,
        price: "₱610",
        description: "24 pieces of our delectable chocolate mini donuts and 24 pieces of our aromatic matcha mini donuts served on a tray together.",
        ingredientsCost: "₱402",
        ingredients: [
            { name: "All-purpose flour", quantity: 4, uom: "cups", category: "Dry Ingredients", price: 45, unit: "total" },
            { name: "White sugar", quantity: 0.25, uom: "cups", category: "Dry Ingredients", price: 4, unit: "total" },
            { name: "Instant dry yeast", quantity: 2.25, uom: "tsp", category: "Leavening", price: 7, unit: "total" },
            { name: "Salt", quantity: 1, uom: "tsp", category: "Spices", price: 1, unit: "total" },
            { name: "Vanilla Extract", quantity: 1, uom: "tsp", category: "Flavoring", price: 10, unit: "total" },
            { name: "Warm milk", quantity: 1, uom: "cup", category: "Wet Ingredients", price: 30, unit: "total" },
            { name: "Unsalted butter", quantity: 0.25, uom: "cup", category: "Wet Ingredients", price: 45, unit: "total" },
            { name: "Eggs", quantity: 2, uom: "pieces", category: "Wet Ingredients", price: 25, unit: "total" },
            { name: "Chocolate & Matcha Cream", quantity: 1.5, uom: "cups", category: "Fillings", price: 135, unit: "total" },
            { name: "Chocolate & Matcha Icing", quantity: 1, uom: "cup", category: "Toppings", price: 100, unit: "total" }
        ]
    },
    {
        id: 6,
        name: "Donut Tray B.3 - Strawberry & Matcha",
        currentStock: 8,
        maxStock: 30,
        image: "Donut Tray B.3",
        lastUpdated: "2024-01-15",
        status: "critical",
        change: 1,
        price: "₱625",
        description: "24 pieces of our fruity strawberry mini donuts and 24 pieces of our aromatic matcha mini donuts served on a tray together.",
        ingredientsCost: "₱402",
        ingredients: [
            { name: "All-purpose flour", quantity: 4, uom: "cups", category: "Dry Ingredients", price: 45, unit: "total" },
            { name: "White sugar", quantity: 0.25, uom: "cups", category: "Dry Ingredients", price: 4, unit: "total" },
            { name: "Instant dry yeast", quantity: 2.25, uom: "tsp", category: "Leavening", price: 7, unit: "total" },
            { name: "Salt", quantity: 1, uom: "tsp", category: "Spices", price: 1, unit: "total" },
            { name: "Vanilla Extract", quantity: 1, uom: "tsp", category: "Flavoring", price: 10, unit: "total" },
            { name: "Warm milk", quantity: 1, uom: "cup", category: "Wet Ingredients", price: 30, unit: "total" },
            { name: "Unsalted butter", quantity: 0.25, uom: "cup", category: "Wet Ingredients", price: 45, unit: "total" },
            { name: "Eggs", quantity: 2, uom: "pieces", category: "Wet Ingredients", price: 25, unit: "total" },
            { name: "Strawberry & Matcha Cream", quantity: 1.5, uom: "cups", category: "Fillings", price: 135, unit: "total" },
            { name: "Strawberry & Matcha Icing", quantity: 1, uom: "cup", category: "Toppings", price: 100, unit: "total" }
        ]
    },
    {
        id: 7,
        name: "Donut Tray C - 3 Flavors Assorted",
        currentStock: 25,
        maxStock: 100,
        image: "Donut Tray C",
        lastUpdated: "2024-01-14",
        status: "normal",
        change: 1,
        price: "₱625",
        description: "16 pieces each of chocolate, strawberry, and matcha mini donuts served on a tray. All flavors with their respective icing and cream fillings.",
        ingredientsCost: "₱402",
        ingredients: [
            { name: "All-purpose flour", quantity: 4, uom: "cups", category: "Dry Ingredients", price: 45, unit: "total" },
            { name: "White sugar", quantity: 0.25, uom: "cups", category: "Dry Ingredients", price: 4, unit: "total" },
            { name: "Instant dry yeast", quantity: 2.25, uom: "tsp", category: "Leavening", price: 7, unit: "total" },
            { name: "Salt", quantity: 1, uom: "tsp", category: "Spices", price: 1, unit: "total" },
            { name: "Vanilla Extract", quantity: 1, uom: "tsp", category: "Flavoring", price: 10, unit: "total" },
            { name: "Warm milk", quantity: 1, uom: "cup", category: "Wet Ingredients", price: 30, unit: "total" },
            { name: "Unsalted butter", quantity: 0.25, uom: "cup", category: "Wet Ingredients", price: 45, unit: "total" },
            { name: "Eggs", quantity: 2, uom: "pieces", category: "Wet Ingredients", price: 25, unit: "total" },
            { name: "Assorted Cream Fillings", quantity: 1.5, uom: "cups", category: "Fillings", price: 135, unit: "total" },
            { name: "Assorted Icings", quantity: 1, uom: "cup", category: "Toppings", price: 100, unit: "total" }
        ]
    },
    {
        id: 8,
        name: "Donut Tower A - 3 Flavors Assorted",
        currentStock: 30,
        maxStock: 100,
        image: "Donut Tower A",
        lastUpdated: "2024-01-15",
        status: "normal",
        change: 1,
        price: "₱625",
        description: "16 pieces each of chocolate, strawberry, and matcha mini donuts stacked on a tower. All flavors with their respective icing and cream fillings.",
        ingredientsCost: "₱402",
        ingredients: [
            { name: "All-purpose flour", quantity: 4, uom: "cups", category: "Dry Ingredients", price: 45, unit: "total" },
            { name: "White sugar", quantity: 0.25, uom: "cups", category: "Dry Ingredients", price: 4, unit: "total" },
            { name: "Instant dry yeast", quantity: 2.25, uom: "tsp", category: "Leavening", price: 7, unit: "total" },
            { name: "Salt", quantity: 1, uom: "tsp", category: "Spices", price: 1, unit: "total" },
            { name: "Vanilla Extract", quantity: 1, uom: "tsp", category: "Flavoring", price: 10, unit: "total" },
            { name: "Warm milk", quantity: 1, uom: "cup", category: "Wet Ingredients", price: 30, unit: "total" },
            { name: "Unsalted butter", quantity: 0.25, uom: "cup", category: "Wet Ingredients", price: 45, unit: "total" },
            { name: "Eggs", quantity: 2, uom: "pieces", category: "Wet Ingredients", price: 25, unit: "total" },
            { name: "Assorted Cream Fillings", quantity: 1.5, uom: "cups", category: "Fillings", price: 135, unit: "total" },
            { name: "Assorted Icings", quantity: 1, uom: "cup", category: "Toppings", price: 100, unit: "total" }
        ]
    },
    {
        id: 9,
        name: "Donut Wall A - 3 Flavors Assorted",
        currentStock: 35,
        maxStock: 100,
        image: "Donut Wall A",
        lastUpdated: "2024-01-14",
        status: "normal",
        change: 1,
        price: "₱640",
        description: "16 pieces each of chocolate, strawberry, and matcha mini donuts stuck on a wall. All flavors with their respective icing and cream fillings.",
        ingredientsCost: "₱402",
        ingredients: [
            { name: "All-purpose flour", quantity: 4, uom: "cups", category: "Dry Ingredients", price: 45, unit: "total" },
            { name: "White sugar", quantity: 0.25, uom: "cups", category: "Dry Ingredients", price: 4, unit: "total" },
            { name: "Instant dry yeast", quantity: 2.25, uom: "tsp", category: "Leavening", price: 7, unit: "total" },
            { name: "Salt", quantity: 1, uom: "tsp", category: "Spices", price: 1, unit: "total" },
            { name: "Vanilla Extract", quantity: 1, uom: "tsp", category: "Flavoring", price: 10, unit: "total" },
            { name: "Warm milk", quantity: 1, uom: "cup", category: "Wet Ingredients", price: 30, unit: "total" },
            { name: "Unsalted butter", quantity: 0.25, uom: "cup", category: "Wet Ingredients", price: 45, unit: "total" },
            { name: "Eggs", quantity: 2, uom: "pieces", category: "Wet Ingredients", price: 25, unit: "total" },
            { name: "Assorted Cream Fillings", quantity: 1.5, uom: "cups", category: "Fillings", price: 135, unit: "total" },
            { name: "Assorted Icings", quantity: 1, uom: "cup", category: "Toppings", price: 100, unit: "total" }
        ]
    }
];

    // Make stockData globally available
    window.stockData = stockData;

    // DOM elements
    let stocksGrid, lowStockNotification, notificationMessage, closeNotification;
    let ingredientsModal, ingredientsClose, modalIngredientsTable, modalDonutName, modalDonutPrice;
    let modalDonutDescription, modalIngredientsCost, productDialog, productDialogClose;
    let dialogIngredientsTable, dialogDonutName, dialogDonutPrice, dialogDonutDescription;
    let dialogIngredientsCost, dialogCurrentStock, dialogChangeDisplay, dialogDecreaseBtn;
    let dialogIncreaseBtn, dialogUpdateBtn, editProductBtn, deleteProductBtn;
    let addProductModal, addProductClose, saveProductBtn, addIngredientBtn, newIngredientsTable;
    let newIngredientsCost, editProductModal, editProductClose, updateProductBtn;
    let editAddIngredientBtn, editIngredientsTable, editIngredientsCost;
    let updateConfirmationModal, confirmationProductName, confirmationStockChange;
    let confirmationCancelBtn, confirmationConfirmBtn, deleteConfirmationModal, deleteProductName;
    let deleteCancelBtn, deleteConfirmBtn, successModal, successCloseBtn, logoutModal, logoutBtn;
    let logoutCancelBtn, logoutConfirmBtn;

    // Current product being edited in dialog
    let currentProductId = null;

    // Temporary storage for new product ingredients
    let newProductIngredients = [];
    let editProductIngredients = [];

    // Function to initialize DOM elements
    function initializeDOMElements() {
        stocksGrid = document.getElementById('stocksGrid');
        lowStockNotification = document.getElementById('lowStockNotification');
        notificationMessage = document.getElementById('notificationMessage');
        closeNotification = document.getElementById('closeNotification');
        ingredientsModal = document.getElementById('ingredientsModal');
        ingredientsClose = document.getElementById('ingredientsClose');
        modalIngredientsTable = document.getElementById('modalIngredientsTable');
        modalDonutName = document.getElementById('modalDonutName');
        modalDonutPrice = document.getElementById('modalDonutPrice');
        modalDonutDescription = document.getElementById('modalDonutDescription');
        modalIngredientsCost = document.getElementById('modalIngredientsCost');
        
        // Product dialog elements
        productDialog = document.getElementById('productDialog');
        productDialogClose = document.getElementById('productDialogClose');
        dialogIngredientsTable = document.getElementById('dialogIngredientsTable').querySelector('tbody');
        dialogDonutName = document.getElementById('dialogDonutName');
        dialogDonutPrice = document.getElementById('dialogDonutPrice');
        dialogDonutDescription = document.getElementById('dialogDonutDescription');
        dialogIngredientsCost = document.getElementById('dialogIngredientsCost');
        dialogCurrentStock = document.getElementById('dialogCurrentStock');
        dialogChangeDisplay = document.getElementById('dialogChangeDisplay');
        dialogDecreaseBtn = document.getElementById('dialogDecreaseBtn');
        dialogIncreaseBtn = document.getElementById('dialogIncreaseBtn');
        dialogUpdateBtn = document.getElementById('dialogUpdateBtn');
        editProductBtn = document.getElementById('editProductBtn');
        deleteProductBtn = document.getElementById('deleteProductBtn');

        // Add Product Modal elements
        addProductModal = document.getElementById('addProductModal');
        addProductClose = document.getElementById('addProductClose');
        saveProductBtn = document.getElementById('saveProductBtn');
        addIngredientBtn = document.getElementById('addIngredientBtn');
        newIngredientsTable = document.getElementById('newIngredientsTable');
        newIngredientsCost = document.getElementById('newIngredientsCost');

        // Edit Product Modal elements
        editProductModal = document.getElementById('editProductModal');
        editProductClose = document.getElementById('editProductClose');
        updateProductBtn = document.getElementById('updateProductBtn');
        editAddIngredientBtn = document.getElementById('editAddIngredientBtn');
        editIngredientsTable = document.getElementById('editIngredientsTable');
        editIngredientsCost = document.getElementById('editIngredientsCost');

        // Confirmation modal elements
        updateConfirmationModal = document.getElementById('updateConfirmationModal');
        confirmationProductName = document.getElementById('confirmationProductName');
        confirmationStockChange = document.getElementById('confirmationStockChange');
        confirmationCancelBtn = document.querySelector('.confirmation-cancel');
        confirmationConfirmBtn = document.querySelector('.confirmation-confirm');
        
        // Delete confirmation modal elements
        deleteConfirmationModal = document.getElementById('deleteConfirmationModal');
        deleteProductName = document.getElementById('deleteProductName');
        deleteCancelBtn = document.querySelector('.delete-cancel');
        deleteConfirmBtn = document.querySelector('.delete-confirm');
        
        // Success modal elements
        successModal = document.getElementById('successModal');
        successCloseBtn = document.querySelector('.success-close');

        // Logout modal elements
        logoutModal = document.getElementById('logoutModal');
        logoutBtn = document.getElementById('logoutBtn');
        logoutCancelBtn = document.querySelector('.logout-cancel');
        logoutConfirmBtn = document.querySelector('.logout-confirm');
    }

    // Function to sync stock data between pages
    function syncStockData() {
        const storedStockData = JSON.parse(localStorage.getItem('dimiDonutsStockData'));
        if (storedStockData && storedStockData.length > 0) {
            window.stockData = storedStockData;
        } else {
            localStorage.setItem('dimiDonutsStockData', JSON.stringify(window.stockData));
        }
    }

    // Function to calculate total ingredient cost for a product
    function calculateIngredientCost(product) {
        let totalCost = 0;
        product.ingredients.forEach(ingredient => {
            const ingredientCost = ingredient.quantity * ingredient.price;
            totalCost += ingredientCost;
        });
        return Math.round(totalCost);
    }

    // Function to format price with currency
    function formatPrice(amount) {
        return `₱${amount.toLocaleString()}`;
    }

    // Function to determine stock status
    function getStockStatus(current, max) {
        const percentage = (current / max) * 100;
        if (percentage <= 10) return 'critical';
        if (percentage <= 25) return 'low';
        return 'normal';
    }

    // In update_stocks.html, update the createStockCard function:
function createStockCard(product) {
    const status = getStockStatus(product.currentStock, product.maxStock);
    const percentage = (product.currentStock / product.maxStock) * 100;
    const imagePath = getProductImagePath(product.name);
    
    let badgeClass = 'badge-normal';
    let valueClass = '';
    let progressClass = 'progress-normal';
    let cardClass = '';
    
    if (status === 'low') {
        badgeClass = 'badge-low';
        valueClass = 'low';
        progressClass = 'progress-low';
        cardClass = 'low-stock';
    } else if (status === 'critical') {
        badgeClass = 'badge-critical';
        valueClass = 'critical';
        progressClass = 'progress-critical';
        cardClass = 'critical-stock';
    }
    
    return `
        <div class="stock-card ${cardClass}" data-product-id="${product.id}">
            <div class="product-actions">
                <button class="action-btn edit-btn" data-product-id="${product.id}">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="action-btn delete-btn" data-product-id="${product.id}">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
            <div class="stock-header">
                <h3 class="stock-title">${product.name}</h3>
                <span class="stock-badge ${badgeClass}">${status.toUpperCase()}</span>
            </div>
            <div class="stock-image">
                <img src="${imagePath}" alt="${product.name}" class="product-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <div class="image-placeholder" style="display: none;">${product.image}</div>
            </div>
            <div class="stock-info">
                <span class="stock-label">Current Stock</span>
                <span class="stock-value ${valueClass}">${product.currentStock}</span>
            </div>
            <div class="stock-progress">
                <div class="stock-progress-bar ${progressClass}" style="width: ${percentage}%"></div>
            </div>
            <div class="stock-footer">
                <span class="last-updated">Updated: ${product.lastUpdated}</span>
                <span class="stock-capacity">Capacity: ${product.maxStock}</span>
            </div>
        </div>
    `;
}

// Update the getProductImagePath function to use relative paths from the root
function getProductImagePath(productName) {
    const imageMap = {
        // Donut Tray A Series
        "Donut Tray A.1 - Chocolate": "images/donut-trays/A-series/A1-chocolate.jpg",
        "Donut Tray A.2 - Strawberry": "images/donut-trays/A-series/A2-strawberry.jpg",
        "Donut Tray A.3 - Matcha": "images/donut-trays/A-series/A3-matcha.jpg",
        
        // Donut Tray B Series
        "Donut Tray B.1 - Chocolate & Strawberry": "images/donut-trays/B-series/B1-chocolate-strawberry.jpg",
        "Donut Tray B.2 - Chocolate & Matcha": "images/donut-trays/B-series/B2-chocolate-matcha.jpg",
        "Donut Tray B.3 - Strawberry & Matcha": "images/donut-trays/B-series/B3-strawberry-matcha.jpg",
        
        // Donut Tray C Series
        "Donut Tray C - 3 Flavors Assorted": "images/donut-trays/C-series/C-assorted-3flavors.jpg",
        
        // Donut Towers
        "Donut Tower A - 3 Flavors Assorted": "images/donut-towers/A-assorted-3flavors.jpg",
        
        // Donut Walls
        "Donut Wall A - 3 Flavors Assorted": "images/donut-walls/A-assorted-3flavors.jpg"
    };
    
    return imageMap[productName] || "images/placeholder.jpg";
}

    // Function to create add product card
    function createAddProductCard() {
        return `
            <div class="stock-card add-product-card" id="addProductCard">
                <div class="stock-header">
                    <h3 class="stock-title">Add New Product</h3>
                </div>
                <div class="stock-image add-product-icon">
                    <i class="fas fa-plus"></i>
                </div>
                <div class="stock-info">
                    <span class="stock-label">Click to add</span>
                    <span class="stock-value">New</span>
                </div>
                <div class="stock-progress">
                    <div class="stock-progress-bar progress-normal" style="width: 0%"></div>
                </div>
                <div class="stock-footer">
                    <span class="last-updated">Add new donut product</span>
                </div>
            </div>
        `;
    }

    // Function to show ingredients modal
    function showIngredientsModal(productId) {
        const product = window.stockData.find(p => p.id === productId);
        if (!product) return;
        
        // Calculate total ingredient cost
        const totalIngredientCost = calculateIngredientCost(product);
        
        // Update product info
        modalDonutName.textContent = product.name.toUpperCase();
        modalDonutPrice.textContent = product.price;
        modalDonutDescription.textContent = product.description;
        modalIngredientsCost.textContent = formatPrice(totalIngredientCost);
        
        // Populate ingredients table with calculated costs
        modalIngredientsTable.innerHTML = product.ingredients.map(ingredient => {
            const ingredientCost = ingredient.quantity * ingredient.price;
            return `
                <tr>
                    <td>${ingredient.name}</td>
                    <td>${ingredient.unit}</td>
                    <td>${ingredient.category}</td>
                    <td>${ingredient.quantity} ${ingredient.uom}</td>
                    <td>${formatPrice(ingredient.price)}</td>
                    <td>${formatPrice(ingredientCost)}</td>
                </tr>
            `;
        }).join('');
        
        // Add total row
        modalIngredientsTable.innerHTML += `
            <tr style="background-color: #f8f9fa; font-weight: 600;">
                <td colspan="5" style="text-align: right;">Total Ingredient Cost:</td>
                <td>${formatPrice(totalIngredientCost)}</td>
            </tr>
        `;
        
        // Show modal
        ingredientsModal.classList.add('active');
    }

    // Function to open product dialog
    function openProductDialog(productId) {
        const product = window.stockData.find(p => p.id === productId);
        if (!product) return;
        
        currentProductId = productId;
        
        // Calculate total ingredient cost
        const totalIngredientCost = calculateIngredientCost(product);
        
        // Update dialog content
        dialogDonutName.textContent = product.name.toUpperCase();
        dialogDonutPrice.textContent = product.price;
        dialogDonutDescription.textContent = product.description;
        dialogIngredientsCost.textContent = formatPrice(totalIngredientCost);
        dialogCurrentStock.textContent = product.currentStock;
        dialogChangeDisplay.textContent = `+${product.change}`;
        
        // Populate ingredients table with calculated costs
        dialogIngredientsTable.innerHTML = product.ingredients.map(ingredient => {
            const ingredientCost = ingredient.quantity * ingredient.price;
            return `
                <tr>
                    <td>${ingredient.name}</td>
                    <td>${ingredient.unit}</td>
                    <td>${ingredient.category}</td>
                    <td>${ingredient.quantity} ${ingredient.uom}</td>
                    <td>${formatPrice(ingredient.price)}</td>
                    <td>${formatPrice(ingredientCost)}</td>
                </tr>
            `;
        }).join('');
        
        // Add total row
        dialogIngredientsTable.innerHTML += `
            <tr style="background-color: #f8f9fa; font-weight: 600;">
                <td colspan="5" style="text-align: right;">Total Ingredient Cost:</td>
                <td>${formatPrice(totalIngredientCost)}</td>
            </tr>
        `;
        
        // Show dialog
        productDialog.classList.add('active');
    }

    // Function to open add product modal
    function openAddProductModal() {
        // Reset form
        newProductIngredients = [];
        updateNewIngredientsTable();
        document.getElementById('productName').value = '';
        document.getElementById('productPrice').value = '';
        document.getElementById('productDescription').value = '';
        document.getElementById('maxStock').value = '50';
        
        // Reset ingredient form
        document.getElementById('ingredientName').value = '';
        document.getElementById('ingredientQuantity').value = '';
        document.getElementById('ingredientUnit').value = 'kilos';
        document.getElementById('ingredientCategory').value = 'Dry Ingredients';
        document.getElementById('ingredientPrice').value = '';
        document.getElementById('ingredientUnitType').value = '';
        
        // Show modal
        addProductModal.classList.add('active');
    }

    // Function to open edit product modal
    function openEditProductModal(productId) {
        const product = window.stockData.find(p => p.id === productId);
        if (!product) return;
        
        currentProductId = productId;
        
        // Set form values
        document.getElementById('editProductName').value = product.name;
        document.getElementById('editProductPrice').value = parseFloat(product.price.replace('₱', '').replace(',', ''));
        document.getElementById('editProductDescription').value = product.description;
        document.getElementById('editMaxStock').value = product.maxStock;
        
        // Set ingredients
        editProductIngredients = [...product.ingredients];
        updateEditIngredientsTable();
        
        // Reset ingredient form
        document.getElementById('editIngredientName').value = '';
        document.getElementById('editIngredientQuantity').value = '';
        document.getElementById('editIngredientUnit').value = 'kilos';
        document.getElementById('editIngredientCategory').value = 'Dry Ingredients';
        document.getElementById('editIngredientPrice').value = '';
        document.getElementById('editIngredientUnitType').value = '';
        
        // Show modal
        editProductModal.classList.add('active');
    }

    // Function to add ingredient to the new product
    function addIngredientToProduct() {
        const name = document.getElementById('ingredientName').value.trim();
        const quantity = parseFloat(document.getElementById('ingredientQuantity').value);
        const unit = document.getElementById('ingredientUnit').value;
        const category = document.getElementById('ingredientCategory').value;
        const price = parseFloat(document.getElementById('ingredientPrice').value);
        const unitType = document.getElementById('ingredientUnitType').value.trim();
        
        // Validate inputs
        if (!name || isNaN(quantity) || quantity <= 0 || isNaN(price) || price < 0 || !unitType) {
            showValidationError('Please fill all ingredient fields with valid values');
            return;
        }
        
        // Add ingredient to the list
        newProductIngredients.push({
            name,
            quantity,
            uom: unit,
            category,
            price,
            unit: unitType
        });
        
        // Update the table and reset form
        updateNewIngredientsTable();
        
        // Reset form
        document.getElementById('ingredientName').value = '';
        document.getElementById('ingredientQuantity').value = '';
        document.getElementById('ingredientPrice').value = '';
        document.getElementById('ingredientUnitType').value = '';
    }

    // Function to add ingredient to the edit product
    function addIngredientToEditProduct() {
        const name = document.getElementById('editIngredientName').value.trim();
        const quantity = parseFloat(document.getElementById('editIngredientQuantity').value);
        const unit = document.getElementById('editIngredientUnit').value;
        const category = document.getElementById('editIngredientCategory').value;
        const price = parseFloat(document.getElementById('editIngredientPrice').value);
        const unitType = document.getElementById('editIngredientUnitType').value.trim();
        
        // Validate inputs
        if (!name || isNaN(quantity) || quantity <= 0 || isNaN(price) || price < 0 || !unitType) {
            showValidationError('Please fill all ingredient fields with valid values');
            return;
        }
        
        // Add ingredient to the list
        editProductIngredients.push({
            name,
            quantity,
            uom: unit,
            category,
            price,
            unit: unitType
        });
        
        // Update the table and reset form
        updateEditIngredientsTable();
        
        // Reset form
        document.getElementById('editIngredientName').value = '';
        document.getElementById('editIngredientQuantity').value = '';
        document.getElementById('editIngredientPrice').value = '';
        document.getElementById('editIngredientUnitType').value = '';
    }

    // Function to update the new ingredients table
    function updateNewIngredientsTable() {
        // Clear table
        newIngredientsTable.innerHTML = '';
        
        // Add ingredients to table
        newProductIngredients.forEach((ingredient, index) => {
            const ingredientCost = ingredient.quantity * ingredient.price;
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${ingredient.name}</td>
                <td>${ingredient.unit}</td>
                <td>${ingredient.category}</td>
                <td>${ingredient.quantity} ${ingredient.uom}</td>
                <td>${formatPrice(ingredient.price)}</td>
                <td>${formatPrice(ingredientCost)}</td>
                <td><button class="remove-ingredient" data-index="${index}">Remove</button></td>
            `;
            newIngredientsTable.appendChild(row);
        });
        
        // Add event listeners to remove buttons
        document.querySelectorAll('.remove-ingredient').forEach(button => {
            button.addEventListener('click', function() {
                const index = parseInt(this.getAttribute('data-index'));
                newProductIngredients.splice(index, 1);
                updateNewIngredientsTable();
            });
        });
        
        // Update total cost
        updateNewIngredientsTotalCost();
    }

    // Function to update the edit ingredients table
    function updateEditIngredientsTable() {
        // Clear table
        editIngredientsTable.innerHTML = '';
        
        // Add ingredients to table
        editProductIngredients.forEach((ingredient, index) => {
            const ingredientCost = ingredient.quantity * ingredient.price;
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${ingredient.name}</td>
                <td>${ingredient.unit}</td>
                <td>${ingredient.category}</td>
                <td>${ingredient.quantity} ${ingredient.uom}</td>
                <td>${formatPrice(ingredient.price)}</td>
                <td>${formatPrice(ingredientCost)}</td>
                <td><button class="remove-ingredient" data-index="${index}">Remove</button></td>
            `;
            editIngredientsTable.appendChild(row);
        });
        
        // Add event listeners to remove buttons
        document.querySelectorAll('#editIngredientsTable .remove-ingredient').forEach(button => {
            button.addEventListener('click', function() {
                const index = parseInt(this.getAttribute('data-index'));
                editProductIngredients.splice(index, 1);
                updateEditIngredientsTable();
            });
        });
        
        // Update total cost
        updateEditIngredientsTotalCost();
    }

    // Function to calculate and update total ingredients cost for new product
    function updateNewIngredientsTotalCost() {
        let totalCost = 0;
        newProductIngredients.forEach(ingredient => {
            totalCost += ingredient.quantity * ingredient.price;
        });
        newIngredientsCost.textContent = formatPrice(Math.round(totalCost));
    }

    // Function to calculate and update total ingredients cost for edit product
    function updateEditIngredientsTotalCost() {
        let totalCost = 0;
        editProductIngredients.forEach(ingredient => {
            totalCost += ingredient.quantity * ingredient.price;
        });
        editIngredientsCost.textContent = formatPrice(Math.round(totalCost));
    }

    // Function to show validation error
    function showValidationError(message) {
        // Create a temporary validation message
        const validationDiv = document.createElement('div');
        validationDiv.className = 'validation-error';
        validationDiv.textContent = message;
        validationDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ff4757;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            z-index: 10000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        `;
        document.body.appendChild(validationDiv);
        
        setTimeout(() => {
            validationDiv.remove();
        }, 3000);
    }

    // Function to show add product confirmation
    function showAddProductConfirmation() {
        const name = document.getElementById('productName').value.trim();
        const price = parseFloat(document.getElementById('productPrice').value);
        const description = document.getElementById('productDescription').value.trim();
        const maxStock = parseInt(document.getElementById('maxStock').value);
        
        // Validate inputs
        if (!name || isNaN(price) || price <= 0 || !description || isNaN(maxStock) || maxStock <= 0) {
            showValidationError('Please fill all product fields with valid values');
            return;
        }
        
        if (newProductIngredients.length === 0) {
            showValidationError('Please add at least one ingredient to the product');
            return;
        }
        
        // Show confirmation modal
        document.getElementById('addConfirmationProductName').textContent = name;
        document.getElementById('addConfirmationProductPrice').textContent = formatPrice(price);
        document.getElementById('addConfirmationProductStock').textContent = maxStock;
        document.getElementById('addProductConfirmationModal').classList.add('active');
    }

    // Function to save the new product
    function saveNewProduct() {
        const name = document.getElementById('productName').value.trim();
        const price = parseFloat(document.getElementById('productPrice').value);
        const description = document.getElementById('productDescription').value.trim();
        const maxStock = parseInt(document.getElementById('maxStock').value);
        
        // Create new product object
        const newProduct = {
            id: window.stockData.length + 1,
            name: name,
            currentStock: 0,
            maxStock: maxStock,
            image: name,
            lastUpdated: new Date().toISOString().split('T')[0],
            status: "critical",
            change: 1,
            price: `₱${price.toLocaleString()}`,
            description: description,
            ingredientsCost: newIngredientsCost.textContent,
            ingredients: [...newProductIngredients]
        };
        
        // Add to stock data
        window.stockData.push(newProduct);
        
        // Save to localStorage
        localStorage.setItem('dimiDonutsStockData', JSON.stringify(window.stockData));
        
        // Update UI
        updateUI();
        
        // Close modals
        addProductModal.classList.remove('active');
        document.getElementById('addProductConfirmationModal').classList.remove('active');
        
        // Show success modal
        document.getElementById('addProductSuccessModal').classList.add('active');
    }

    // Function to show update product confirmation
    function showUpdateProductConfirmation() {
        const name = document.getElementById('editProductName').value.trim();
        const price = parseFloat(document.getElementById('editProductPrice').value);
        const description = document.getElementById('editProductDescription').value.trim();
        const maxStock = parseInt(document.getElementById('editMaxStock').value);
        
        // Validate inputs
        if (!name || isNaN(price) || price <= 0 || !description || isNaN(maxStock) || maxStock <= 0) {
            showValidationError('Please fill all product fields with valid values');
            return;
        }
        
        if (editProductIngredients.length === 0) {
            showValidationError('Please add at least one ingredient to the product');
            return;
        }
        
        // Show confirmation modal
        document.getElementById('updateProductConfirmationName').textContent = name;
        document.getElementById('updateProductConfirmationModal').classList.add('active');
    }

    // Function to update the product
    function updateProduct() {
        const product = window.stockData.find(p => p.id === currentProductId);
        if (!product) return;
        
        const name = document.getElementById('editProductName').value.trim();
        const price = parseFloat(document.getElementById('editProductPrice').value);
        const description = document.getElementById('editProductDescription').value.trim();
        const maxStock = parseInt(document.getElementById('editMaxStock').value);
        
        // Update product
        product.name = name;
        product.price = `₱${price.toLocaleString()}`;
        product.description = description;
        product.maxStock = maxStock;
        product.ingredients = [...editProductIngredients];
        product.ingredientsCost = editIngredientsCost.textContent;
        product.lastUpdated = new Date().toISOString().split('T')[0];
        
        // Save to localStorage
        localStorage.setItem('dimiDonutsStockData', JSON.stringify(window.stockData));
        
        // Update UI
        updateUI();
        
        // Close modals
        editProductModal.classList.remove('active');
        document.getElementById('updateProductConfirmationModal').classList.remove('active');
        
        // Show success modal
        successModal.classList.add('active');
    }

    // Function to delete the product
    function deleteProduct() {
        const productIndex = window.stockData.findIndex(p => p.id === currentProductId);
        if (productIndex === -1) return;
        
        // Remove product from array
        window.stockData.splice(productIndex, 1);
        
        // Save to localStorage
        localStorage.setItem('dimiDonutsStockData', JSON.stringify(window.stockData));
        
        // Update UI
        updateUI();
        
        // Close modals
        productDialog.classList.remove('active');
        deleteConfirmationModal.classList.remove('active');
        
        // Show success modal
        successModal.classList.add('active');
    }

    // Function to show delete confirmation
    function showDeleteConfirmation() {
        const product = window.stockData.find(p => p.id === currentProductId);
        if (product) {
            deleteProductName.textContent = product.name;
            deleteConfirmationModal.classList.add('active');
        }
    }

    // Function to update stock change in dialog
    function updateDialogStockChange(change) {
        const product = window.stockData.find(p => p.id === currentProductId);
        if (product) {
            product.change = Math.max(0, product.change + change);
            dialogChangeDisplay.textContent = `+${product.change}`;
        }
    }

    // Function to show update confirmation
    function showUpdateConfirmation() {
        const product = window.stockData.find(p => p.id === currentProductId);
        if (product) {
            confirmationProductName.textContent = product.name;
            confirmationStockChange.textContent = `+${product.change}`;
            updateConfirmationModal.classList.add('active');
        }
    }

    // Function to update stock in dialog
    function updateDialogStock() {
        const product = window.stockData.find(p => p.id === currentProductId);
        if (product) {
            product.currentStock = Math.min(product.maxStock, product.currentStock + product.change);
            product.change = 0;
            product.lastUpdated = new Date().toISOString().split('T')[0];
            
            // Save to localStorage
            localStorage.setItem('dimiDonutsStockData', JSON.stringify(window.stockData));
            
            // Update UI
            updateUI();
            
            // Close dialogs
            productDialog.classList.remove('active');
            updateConfirmationModal.classList.remove('active');
            
            // Check for low stock after update
            checkLowStock();
            
            // Show success message
            successModal.classList.add('active');
        }
    }

    // Function to check for low stock and show notification
    function checkLowStock() {
        const stockData = JSON.parse(localStorage.getItem('dimiDonutsStockData')) || window.stockData;
        const lowStockItems = stockData.filter(item => {
            const percentage = (item.currentStock / item.maxStock) * 100;
            return percentage <= 25; // 25% or lower is considered low stock
        });
        
        if (lowStockItems.length > 0) {
            const criticalItems = lowStockItems.filter(item => {
                const percentage = (item.currentStock / item.maxStock) * 100;
                return percentage <= 10; // 10% or lower is critical
            });
            
            let message = '';
            if (criticalItems.length > 0) {
                const criticalNames = criticalItems.map(item => item.name).join(', ');
                message = `${criticalItems.length} product(s) are critically low on stock! (${criticalNames})`;
            } else {
                message = `${lowStockItems.length} product(s) are running low on stock.`;
            }
            
            notificationMessage.textContent = message;
            lowStockNotification.classList.add('active');
            
            // Auto hide after 10 seconds
            setTimeout(() => {
                lowStockNotification.classList.remove('active');
            }, 10000);
        }
    }

    // Function to update UI
    function updateUI() {
        const stockData = JSON.parse(localStorage.getItem('dimiDonutsStockData')) || window.stockData;
        
        stocksGrid.innerHTML = stockData.map(product => createStockCard(product)).join('');
        stocksGrid.innerHTML += createAddProductCard();
        
        // Add click event listeners to stock cards
        document.querySelectorAll('.stock-card:not(.add-product-card)').forEach(card => {
            card.addEventListener('click', function() {
                const productId = parseInt(this.getAttribute('data-product-id'));
                openProductDialog(productId);
            });
            
            // Add double-click for ingredients modal
            card.addEventListener('dblclick', function() {
                const productId = parseInt(this.getAttribute('data-product-id'));
                showIngredientsModal(productId);
            });
        });
        
        // Add click event listener to add product card
        const addProductCard = document.getElementById('addProductCard');
        if (addProductCard) {
            addProductCard.addEventListener('click', openAddProductModal);
        }
        
        // Add event listeners to edit and delete buttons
        document.querySelectorAll('.edit-btn').forEach(button => {
            button.addEventListener('click', function(e) {
                e.stopPropagation();
                const productId = parseInt(this.getAttribute('data-product-id'));
                openEditProductModal(productId);
            });
        });
        
        document.querySelectorAll('.delete-btn').forEach(button => {
            button.addEventListener('click', function(e) {
                e.stopPropagation();
                const productId = parseInt(this.getAttribute('data-product-id'));
                currentProductId = productId;
                showDeleteConfirmation();
            });
        });
    }

    // Function to setup event listeners
    function setupEventListeners() {
        // Close notification
        closeNotification.addEventListener('click', () => {
            lowStockNotification.classList.remove('active');
        });
        
        // Close ingredients modal
        ingredientsClose.addEventListener('click', () => {
            ingredientsModal.classList.remove('active');
        });
        
        // Close modal when clicking outside
        window.addEventListener('click', (event) => {
            if (event.target === ingredientsModal) {
                ingredientsModal.classList.remove('active');
            }
        });
        
        // Product dialog event listeners
        productDialogClose.addEventListener('click', () => {
            productDialog.classList.remove('active');
        });
        
        dialogDecreaseBtn.addEventListener('click', () => {
            updateDialogStockChange(-1);
        });
        
        dialogIncreaseBtn.addEventListener('click', () => {
            updateDialogStockChange(1);
        });
        
        dialogUpdateBtn.addEventListener('click', () => {
            showUpdateConfirmation();
        });
        
        editProductBtn.addEventListener('click', () => {
            productDialog.classList.remove('active');
            openEditProductModal(currentProductId);
        });
        
        deleteProductBtn.addEventListener('click', () => {
            productDialog.classList.remove('active');
            showDeleteConfirmation();
        });
        
        // Add Product Modal event listeners
        addProductClose.addEventListener('click', () => {
            addProductModal.classList.remove('active');
        });
        
        addIngredientBtn.addEventListener('click', addIngredientToProduct);
        
        saveProductBtn.addEventListener('click', showAddProductConfirmation);
        
        // Edit Product Modal event listeners
        editProductClose.addEventListener('click', () => {
            editProductModal.classList.remove('active');
        });
        
        editAddIngredientBtn.addEventListener('click', addIngredientToEditProduct);
        
        updateProductBtn.addEventListener('click', showUpdateProductConfirmation);
        
        // Confirmation modal event listeners
        confirmationCancelBtn.addEventListener('click', () => {
            updateConfirmationModal.classList.remove('active');
        });
        
        confirmationConfirmBtn.addEventListener('click', () => {
            updateDialogStock();
        });
        
        // Delete confirmation modal event listeners
        deleteCancelBtn.addEventListener('click', () => {
            deleteConfirmationModal.classList.remove('active');
        });
        
        deleteConfirmBtn.addEventListener('click', () => {
            deleteProduct();
        });
        
        // Add Product Confirmation event listeners
        document.querySelector('.add-confirm-cancel')?.addEventListener('click', () => {
            document.getElementById('addProductConfirmationModal').classList.remove('active');
        });
        
        document.querySelector('.add-confirm-confirm')?.addEventListener('click', () => {
            saveNewProduct();
        });
        
        // Update Product Confirmation event listeners
        document.querySelector('.update-confirm-cancel')?.addEventListener('click', () => {
            document.getElementById('updateProductConfirmationModal').classList.remove('active');
        });
        
        document.querySelector('.update-confirm-confirm')?.addEventListener('click', () => {
            updateProduct();
        });
        
        // Close success modals
        successCloseBtn.addEventListener('click', () => {
            successModal.classList.remove('active');
        });
        
        document.querySelector('.add-success-close')?.addEventListener('click', () => {
            document.getElementById('addProductSuccessModal').classList.remove('active');
        });
        
        // Logout functionality
        logoutBtn.addEventListener('click', function(e) {
            e.preventDefault();
            logoutModal.classList.add('active');
        });

        logoutCancelBtn.addEventListener('click', function() {
            logoutModal.classList.remove('active');
        });

        logoutConfirmBtn.addEventListener('click', function() {
            window.location.href = 'index.html';
        });

        // Close modals when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target === successModal) {
                successModal.classList.remove('active');
            }
            if (event.target === logoutModal) {
                logoutModal.classList.remove('active');
            }
            if (event.target === updateConfirmationModal) {
                updateConfirmationModal.classList.remove('active');
            }
            if (event.target === addProductModal) {
                addProductModal.classList.remove('active');
            }
            if (event.target === editProductModal) {
                editProductModal.classList.remove('active');
            }
            if (event.target === productDialog) {
                productDialog.classList.remove('active');
            }
            if (event.target === document.getElementById('addProductConfirmationModal')) {
                document.getElementById('addProductConfirmationModal').classList.remove('active');
            }
            if (event.target === document.getElementById('updateProductConfirmationModal')) {
                document.getElementById('updateProductConfirmationModal').classList.remove('active');
            }
            if (event.target === document.getElementById('addProductSuccessModal')) {
                document.getElementById('addProductSuccessModal').classList.remove('active');
            }
        });
    }

    // Initialize the page
    function initializePage() {
        // Initialize DOM elements first
        initializeDOMElements();
        
        // Sync stock data on page load
        syncStockData();
        
        // Calculate ingredient costs for all products if needed
        window.stockData.forEach(product => {
            if (!product.ingredientsCost || product.ingredientsCost === "₱0") {
                const totalCost = calculateIngredientCost(product);
                product.ingredientsCost = formatPrice(totalCost);
            }
        });
        
        // Save initial stock data if not exists
        if (!localStorage.getItem('dimiDonutsStockData')) {
            localStorage.setItem('dimiDonutsStockData', JSON.stringify(window.stockData));
        }
        
        // Setup event listeners
        setupEventListeners();
        
        // Render stock cards
        updateUI();
        
        // Check current stock status
        setTimeout(checkLowStock, 1000);
    }

    // Initialize when DOM is fully loaded
    document.addEventListener('DOMContentLoaded', initializePage);
</script>
</body>
</html>